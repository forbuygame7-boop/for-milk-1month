<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Love Control</title>
    <style>
        body { font-family: 'Sarabun', sans-serif; padding: 20px; background: #f4f4f9; color: #333; }
        .box { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #444; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ä‡∏ó */
        .chat-log { height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; background: #fafafa; border-radius: 10px; }
        .msg-row { margin-bottom: 8px; padding: 8px 12px; border-radius: 15px; font-size: 14px; display: inline-block; clear: both; max-width: 80%; }
        .u { background: #00c300; color: white; float: right; text-align: right; } /* ‡∏°‡∏¥‡πâ‡∏ß */
        .b { background: #e9e9eb; color: black; float: left; text-align: left; } /* ‡∏ö‡∏≠‡∏ó */
        
        /* ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ */
        input[type="text"], input[type="number"], textarea, input[type="color"] { 
            width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ccc; outline: none; box-sizing: border-box; font-family: 'Sarabun', sans-serif; margin-bottom: 10px;
        }
        input[type="color"] { height: 40px; padding: 2px; }
        textarea { resize: vertical; min-height: 100px; }
        label { font-weight: bold; font-size: 14px; color: #555; }
        
        button { padding: 10px 20px; border: none; cursor: pointer; border-radius: 20px; font-weight: bold; transition: 0.2s; }
        button:hover { opacity: 0.8; transform: scale(1.05); }

        .send-btn { background: #007bff; color: white; width: 25%; }
        .switch-btn { padding: 15px; width: 100%; font-size: 1.2rem; cursor: pointer; border: none; border-radius: 10px; color: white; width: 100%; margin-bottom: 10px;}
        .on { background: #28a745; box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3); }
        .off { background: #dc3545; box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3); }
        .delete-btn { background: #ff4757; color: white; width: 100%; padding: 10px; }
        .save-btn { background: #28a745; color: white; padding: 15px; width: 100%; font-size: 18px; box-shadow: 0 4px 10px rgba(40,167,69,0.3); margin-top: 20px;}
    </style>
</head>
<body>

    <div class="box">
        <h2>üéÆ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó</h2>
        <button id="botSwitch" class="switch-btn on" onclick="toggleBot()">‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...</button>
        <button onclick="clearChat()" class="delete-btn">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>

    <div class="box">
        <h2 style="color: #333;">‚öôÔ∏è ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</h2>

        <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">üé® ‡∏ò‡∏µ‡∏°‡∏™‡∏µ</h3>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <div style="flex:1; min-width: 80px;"><label>‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á:</label><br><input type="color" id="conf_bg"></div>
            <div style="flex:1; min-width: 80px;"><label>‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠:</label><br><input type="color" id="conf_text"></div>
            <div style="flex:1; min-width: 80px;"><label>‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°:</label><br><input type="color" id="conf_btn"></div>
            <div style="flex:1; min-width: 80px;"><label>‡∏™‡∏µ‡πÅ‡∏°‡∏ß üê±:</label><br><input type="color" id="conf_cat"></div>
        </div>

        <br><hr><br>

        <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å</h3>
        <label>‡∏û‡∏≤‡∏î‡∏´‡∏±‡∏ß (Headline):</label>
        <input type="text" id="conf_headline">
        
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡∏£‡∏±‡∏Å (Footer):</label>
        <input type="text" id="conf_names">

        <br><hr><br>
        
        <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">üíå ‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏±‡∏ö</h3>
        <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢ (‡πÉ‡∏ä‡πâ &lt;br&gt; ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà):</label>
        <textarea id="conf_deep_msg" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÉ‡∏à‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ..."></textarea>
        
        <br><hr><br>

        <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">‚ù§Ô∏è ‡πÄ‡∏Å‡∏°‡∏´‡∏±‡∏ß‡πÉ‡∏à</h3>
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Max Hearts):</label>
        <input type="number" id="conf_max_hearts" style="width: 100px;">
        
        <button onclick="saveAllSettings()" class="save-btn">
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </button>
    </div>

    <div class="box">
        <h2>üí¨ ‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó Real-time</h2>
        <div class="chat-log" id="adminChatLog">Loading...</div>
        <div style="display:flex; gap:10px;">
            <input type="text" id="adminInput" placeholder="‡∏ï‡∏≠‡∏ö‡πÉ‡∏ô‡∏ô‡∏≤‡∏°‡∏ö‡∏≠‡∏ó..." onkeypress="handleEnter(event)">
            <button onclick="adminSend()" class="send-btn">‡∏™‡πà‡∏á</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, set, query, limitToLast, remove, update } 
        from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyC9pqct58Qc61jRF-h0c2nt1ntctxF-CJc",
            authDomain: "love-chat-1month.firebaseapp.com",
            databaseURL: "https://love-chat-1month-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "love-chat-1month",
            storageBucket: "love-chat-1month.firebasestorage.app",
            messagingSenderId: "434980133810",
            appId: "1:434980133810:web:12929b8f2843dd07c162ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // -------------------------
        // 1. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Firebase ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á Input
        // -------------------------
        onValue(ref(db, 'site_config'), (snapshot) => {
            const data = snapshot.val();
            if(data) {
                // ‡∏™‡∏µ
                if(data.colors) {
                    document.getElementById('conf_bg').value = data.colors.background || "#ffffff";
                    document.getElementById('conf_text').value = data.colors.text || "#000000";
                    document.getElementById('conf_btn').value = data.colors.button || "#ff0000";
                    document.getElementById('conf_cat').value = data.colors.cat || "#ffffff";
                }
                // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                document.getElementById('conf_headline').value = data.headline || "";
                document.getElementById('conf_names').value = data.coupleNames || "";
                
                // ‚úÖ ‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!)
                document.getElementById('conf_deep_msg').value = data.deepMessage || "";

                // ‡πÄ‡∏Å‡∏°
                if(data.game) {
                    document.getElementById('conf_max_hearts').value = data.game.maxHearts || 100;
                }
            }
        });

        // -------------------------
        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤ (Save)
        // -------------------------
        window.saveAllSettings = function() {
            const updates = {};
            
            // ‡∏™‡∏µ
            updates['site_config/colors/background'] = document.getElementById('conf_bg').value;
            updates['site_config/colors/text'] = document.getElementById('conf_text').value;
            updates['site_config/colors/button'] = document.getElementById('conf_btn').value;
            updates['site_config/colors/cat'] = document.getElementById('conf_cat').value;
            
            // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
            updates['site_config/headline'] = document.getElementById('conf_headline').value;
            updates['site_config/coupleNames'] = document.getElementById('conf_names').value;
            
            // ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢
            updates['site_config/deepMessage'] = document.getElementById('conf_deep_msg').value;
            
            // ‡πÄ‡∏Å‡∏°
            updates['site_config/game/maxHearts'] = parseInt(document.getElementById('conf_max_hearts').value);

            update(ref(db), updates)
                .then(() => alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏ü‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö"))
                .catch((err) => alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err));
        };

        // -------------------------
        // 3. ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó Admin
        // -------------------------
        const botStatusRef = ref(db, 'bot_status');
        onValue(botStatusRef, (snapshot) => {
            const isActive = snapshot.val();
            const btn = document.getElementById('botSwitch');
            if (isActive) {
                btn.innerText = "‚úÖ ‡∏ö‡∏≠‡∏ó‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà (‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î)";
                btn.className = "switch-btn on";
            } else {
                btn.innerText = "‚ö†Ô∏è ‡∏ö‡∏≠‡∏ó‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà (‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á)";
                btn.className = "switch-btn off";
            }
        });

        const chatRef = query(ref(db, 'chat_logs'), limitToLast(50));
        onValue(chatRef, (snapshot) => {
            const data = snapshot.val();
            const logDiv = document.getElementById('adminChatLog');
            logDiv.innerHTML = ''; 
            if (data) {
                Object.values(data).forEach(msg => {
                    const d = document.createElement('div');
                    const isUser = msg.sender === 'user';
                    d.className = `msg-row ${isUser ? 'u' : 'b'}`;
                    d.innerHTML = `<b>${isUser ? '‡∏°‡∏¥‡πâ‡∏ß' : '‡∏Ñ‡∏∏‡∏ì/‡∏ö‡∏≠‡∏ó'}</b>: ${msg.text}`;
                    const clearFix = document.createElement('div');
                    clearFix.style.clear = 'both';
                    logDiv.appendChild(d);
                    logDiv.appendChild(clearFix);
                });
                logDiv.scrollTop = logDiv.scrollHeight;
            } else {
                logDiv.innerHTML = '<div style="text-align:center;color:#aaa;padding:20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ä‡∏ó‡∏Ñ‡∏£‡∏±‡∏ö</div>';
            }
        });

        window.toggleBot = function() {
            const btn = document.getElementById('botSwitch');
            const isCurrentlyOn = btn.classList.contains('on');
            set(botStatusRef, !isCurrentlyOn);
        };

        window.adminSend = function() {
            const input = document.getElementById('adminInput');
            if(input.value.trim() === "") return;
            push(ref(db, 'chat_logs'), { text: input.value, sender: 'bot', timestamp: Date.now() });
            input.value = '';
        };

        window.handleEnter = function(e) { if(e.key === 'Enter') adminSend(); }

        window.clearChat = function() {
            if(confirm("‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó‡πÅ‡∏ô‡πà‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö? (‡∏Å‡∏π‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏∞)")) {
                remove(ref(db, 'chat_logs')).then(() => alert("‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"));
            }
        };
    </script>
</body>
</html>
