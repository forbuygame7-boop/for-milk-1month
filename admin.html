<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Love Control</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #eee; }
        .box { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .chat-log { height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; background: #fafafa;}
        .msg-row { margin-bottom: 5px; padding: 5px; border-radius: 5px; }
        .u { background: #dcf8c6; text-align: right; } /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (User) */
        .b { background: #fff; text-align: left; border: 1px solid #eee; } /* ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß (Bot/You) */
        
        input[type="text"] { width: 70%; padding: 10px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .switch-btn { padding: 15px; width: 100%; font-size: 1.2rem; cursor: pointer; border: none; border-radius: 5px; }
        .on { background: #28a745; color: white; }
        .off { background: #dc3545; color: white; }
    </style>
</head>
<body>

    <div class="box">
        <h2>üéÆ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
        <button id="botSwitch" class="switch-btn on" onclick="toggleBot()">
            ‡∏ö‡∏≠‡∏ó‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà (Auto)
        </button>
    </div>

    <div class="box">
        <h2>üí¨ ‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó Real-time</h2>
        <div class="chat-log" id="adminChatLog">Loading...</div>
        
        <div style="display:flex; gap:5px;">
            <input type="text" id="adminInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏ô‡∏≤‡∏°‡∏ö‡∏≠‡∏ó...">
            <button onclick="adminSend()">‡∏™‡πà‡∏á</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, set, query, limitToLast } 
        from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        
        // ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÄ‡∏≠‡∏≤ firebaseConfig ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ô‡∏∞!
        const firebaseConfig = {
        apiKey: "AIzaSyC9pqct58Qc61jRF-h0c2nt1ntctxF-CJc",
        authDomain: "love-chat-1month.firebaseapp.com",
        databaseURL: "https://love-chat-1month-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "love-chat-1month",
        storageBucket: "love-chat-1month.firebasestorage.app",
        messagingSenderId: "434980133810",
        appId: "1:434980133810:web:12929b8f2843dd07c162ab"
    };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 1. ‡∏î‡∏±‡∏Å‡∏ü‡∏±‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏≠‡∏ó
        const botStatusRef = ref(db, 'bot_status');
        onValue(botStatusRef, (snapshot) => {
            const isActive = snapshot.val();
            const btn = document.getElementById('botSwitch');
            if (isActive) {
                btn.innerText = "‚úÖ ‡∏ö‡∏≠‡∏ó‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà (‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î)";
                btn.className = "switch-btn on";
            } else {
                btn.innerText = "‚ö†Ô∏è ‡∏ö‡∏≠‡∏ó‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà (‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á)";
                btn.className = "switch-btn off";
            }
        });

        // 2. ‡∏î‡∏±‡∏Å‡∏ü‡∏±‡∏á‡πÅ‡∏ä‡∏ó
        const chatRef = query(ref(db, 'chat_logs'), limitToLast(50));
        onValue(chatRef, (snapshot) => {
            const data = snapshot.val();
            const logDiv = document.getElementById('adminChatLog');
            logDiv.innerHTML = '';
            
            if (data) {
                Object.values(data).forEach(msg => {
                    const d = document.createElement('div');
                    d.className = `msg-row ${msg.sender === 'user' ? 'u' : 'b'}`;
                    d.innerText = `${msg.sender === 'user' ? '‡∏°‡∏¥‡πâ‡∏ß' : '‡∏Ñ‡∏∏‡∏ì/‡∏ö‡∏≠‡∏ó'}: ${msg.text}`;
                    logDiv.appendChild(d);
                });
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        });

        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Admin
        window.toggleBot = function() {
            const btn = document.getElementById('botSwitch');
            const isCurrentlyOn = btn.classList.contains('on');
            set(botStatusRef, !isCurrentlyOn); // ‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ True/False ‡πÉ‡∏ô Database
        };

        window.adminSend = function() {
            const input = document.getElementById('adminInput');
            if(input.value.trim() === "") return;
            
            push(ref(db, 'chat_logs'), {
                text: input.value,
                sender: 'bot', // ‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏ô‡∏≤‡∏°‡∏ö‡∏≠‡∏ó (‡πÅ‡∏ï‡πà‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö)
                timestamp: Date.now()
            });
            input.value = '';
        };
    </script>
</body>
</html>