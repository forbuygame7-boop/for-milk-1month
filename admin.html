<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Love Control</title>
    <style>
        body { font-family: 'Sarabun', sans-serif; padding: 20px; background: #f4f4f9; color: #333; }
        .box { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #444; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        /* Chat Log Area */
        .chat-log { height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; background: #fafafa; border-radius: 10px; }
        .msg-row { margin-bottom: 8px; padding: 8px 12px; border-radius: 15px; font-size: 14px; display: inline-block; clear: both; max-width: 80%; }
        .u { background: #00c300; color: white; float: right; text-align: right; } /* ‡∏°‡∏¥‡πâ‡∏ß (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß) */
        .b { background: #e9e9eb; color: black; float: left; text-align: left; } /* ‡∏ö‡∏≠‡∏ó/‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏ó‡∏≤) */
        
        /* Controls */
        input[type="text"] { width: 70%; padding: 12px; border-radius: 20px; border: 1px solid #ccc; outline: none; }
        button { padding: 10px 20px; border: none; cursor: pointer; border-radius: 20px; font-weight: bold; transition: 0.2s; }
        button:hover { opacity: 0.8; transform: scale(1.05); }

        .send-btn { background: #007bff; color: white; width: 25%; }
        
        .switch-btn { padding: 15px; width: 100%; font-size: 1.2rem; cursor: pointer; border: none; border-radius: 10px; color: white; }
        .on { background: #28a745; box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3); }
        .off { background: #dc3545; box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3); }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó (‡πÉ‡∏´‡∏°‡πà) */
        .delete-btn {
            background: #ff4757;
            color: white;
            margin-top: 10px;
            width: 100%;
            padding: 10px;
        }
    </style>
</head>
<body>

    <div class="box">
        <h2>üéÆ ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
        <button id="botSwitch" class="switch-btn on" onclick="toggleBot()">
            ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...
        </button>
        
        <button onclick="clearChat()" class="delete-btn">
            üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </button>
    </div>

    <div class="box">
        <h2>üí¨ ‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó Real-time</h2>
        <div class="chat-log" id="adminChatLog">Loading...</div>
        
        <div style="display:flex; gap:10px; justify-content: space-between;">
            <input type="text" id="adminInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏ô‡∏≤‡∏°‡∏ö‡∏≠‡∏ó..." onkeypress="handleEnter(event)">
            <button onclick="adminSend()" class="send-btn">‡∏™‡πà‡∏á</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° 'remove' ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô import
        import { getDatabase, ref, push, onValue, set, query, limitToLast, remove } 
        from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        
        // Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        const firebaseConfig = {
            apiKey: "AIzaSyC9pqct58Qc61jRF-h0c2nt1ntctxF-CJc",
            authDomain: "love-chat-1month.firebaseapp.com",
            databaseURL: "https://love-chat-1month-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "love-chat-1month",
            storageBucket: "love-chat-1month.firebasestorage.app",
            messagingSenderId: "434980133810",
            appId: "1:434980133810:web:12929b8f2843dd07c162ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 1. ‡∏î‡∏±‡∏Å‡∏ü‡∏±‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏≠‡∏ó
        const botStatusRef = ref(db, 'bot_status');
        onValue(botStatusRef, (snapshot) => {
            const isActive = snapshot.val();
            const btn = document.getElementById('botSwitch');
            if (isActive) {
                btn.innerText = "‚úÖ ‡∏ö‡∏≠‡∏ó‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà (‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î)";
                btn.className = "switch-btn on";
            } else {
                btn.innerText = "‚ö†Ô∏è ‡∏ö‡∏≠‡∏ó‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà (‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á)";
                btn.className = "switch-btn off";
            }
        });

        // 2. ‡∏î‡∏±‡∏Å‡∏ü‡∏±‡∏á‡πÅ‡∏ä‡∏ó
        const chatRef = query(ref(db, 'chat_logs'), limitToLast(50));
        onValue(chatRef, (snapshot) => {
            const data = snapshot.val();
            const logDiv = document.getElementById('adminChatLog');
            logDiv.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏à‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
            
            if (data) {
                Object.values(data).forEach(msg => {
                    const d = document.createElement('div');
                    // ‡∏à‡∏±‡∏î‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ô‡∏™‡πà‡∏á
                    // User (‡∏°‡∏¥‡πâ‡∏ß) -> ‡∏Ç‡∏ß‡∏≤ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)
                    // Bot/Admin -> ‡∏ã‡πâ‡∏≤‡∏¢ (‡∏Ç‡∏≤‡∏ß)
                    // *‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: Admin ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏°‡∏≠‡∏á‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏±‡∏ö User ‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏á‡∏á‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå
                    const isUser = msg.sender === 'user';
                    
                    d.className = `msg-row ${isUser ? 'u' : 'b'}`;
                    d.innerHTML = `<b>${isUser ? '‡∏°‡∏¥‡πâ‡∏ß' : '‡∏Ñ‡∏∏‡∏ì/‡∏ö‡∏≠‡∏ó'}</b>: ${msg.text}`;
                    
                    // ‡πÉ‡∏™‡πà div ‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (Clear float)
                    const clearFix = document.createElement('div');
                    clearFix.style.clear = 'both';
                    
                    logDiv.appendChild(d);
                    logDiv.appendChild(clearFix);
                });
                logDiv.scrollTop = logDiv.scrollHeight;
            } else {
                logDiv.innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...</div>';
            }
        });

        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Admin Control
        window.toggleBot = function() {
            const btn = document.getElementById('botSwitch');
            const isCurrentlyOn = btn.classList.contains('on');
            set(botStatusRef, !isCurrentlyOn);
        };

        window.adminSend = function() {
            const input = document.getElementById('adminInput');
            if(input.value.trim() === "") return;
            
            push(ref(db, 'chat_logs'), {
                text: input.value,
                sender: 'bot', 
                timestamp: Date.now()
            });
            input.value = '';
        };

        window.handleEnter = function(e) {
            if(e.key === 'Enter') adminSend();
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó (‡πÉ‡∏´‡∏°‡πà) ---
        window.clearChat = function() {
            if(confirm("‚ö†Ô∏è ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?\n(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!)")) {
                const logsRef = ref(db, 'chat_logs');
                remove(logsRef)
                    .then(() => {
                        alert("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ä‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡πÇ‡∏•‡πà‡∏á‡πÇ‡∏à‡πâ‡∏á‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏û‡∏µ‡πà ‚ú®");
                    })
                    .catch((error) => {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
                    });
            }
        };
    </script>
</body>
</html>